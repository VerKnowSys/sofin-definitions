--- ext/mysql/php_mysql.c	2013-12-10 20:04:57.000000000 +0100
+++ ext/mysql/php_mysql.c	2014-03-12 15:16:29.000000000 +0100
@@ -506,6 +506,7 @@
 	STD_PHP_INI_ENTRY("mysql.default_socket",		NULL,	PHP_INI_ALL,		OnUpdateStringUnempty,	default_socket,	zend_mysql_globals,		mysql_globals)
 #endif
 	STD_PHP_INI_ENTRY("mysql.connect_timeout",		"60",	PHP_INI_ALL,		OnUpdateLong,		connect_timeout, 	zend_mysql_globals,		mysql_globals)
+	STD_PHP_INI_ENTRY("mysql.connect_charset",		NULL,	PHP_INI_ALL,		OnUpdateString,		connect_charset,	zend_mysql_globals,		mysql_globals)
 	STD_PHP_INI_BOOLEAN("mysql.trace_mode",			"0",	PHP_INI_ALL,		OnUpdateLong,		trace_mode, 		zend_mysql_globals,		mysql_globals)
 	STD_PHP_INI_BOOLEAN("mysql.allow_local_infile",	"1",	PHP_INI_SYSTEM,		OnUpdateLong,		allow_local_infile, zend_mysql_globals,		mysql_globals)
 PHP_INI_END()
@@ -523,6 +524,7 @@
 	mysql_globals->connect_errno = 0;
 	mysql_globals->connect_error = NULL;
 	mysql_globals->connect_timeout = 0;
+	mysql_globals->connect_charset = NULL;
 	mysql_globals->trace_mode = 0;
 	mysql_globals->allow_local_infile = 1;
 	mysql_globals->result_allocated = 0;
@@ -691,6 +693,7 @@
 {
 	char *user=NULL, *passwd=NULL, *host_and_port=NULL, *socket=NULL, *tmp=NULL, *host=NULL;
 	int  user_len = 0, passwd_len = 0, host_len = 0;
+	char *connect_charset=NULL;
 	char *hashed_details=NULL;
 	int hashed_details_length, port = MYSQL_PORT;
 	long client_flags = 0;
@@ -710,6 +713,7 @@
 #endif
 
 	connect_timeout = MySG(connect_timeout);
+	connect_charset = MySG(connect_charset);
 
 	socket = MySG(default_socket);
 
@@ -849,6 +853,11 @@
 			if (connect_timeout != -1) {
 				mysql_options(mysql->conn, MYSQL_OPT_CONNECT_TIMEOUT, (const char *)&connect_timeout);
 			}
+
+			if (connect_charset != NULL) {
+				mysql_options(mysql->conn, MYSQL_SET_CHARSET_NAME, connect_charset);
+			}
+
 #ifndef MYSQL_USE_MYSQLND
 			if (mysql_real_connect(mysql->conn, host, user, passwd, NULL, port, socket, client_flags)==NULL)
 #else
@@ -897,6 +906,9 @@
 #endif
 			if (mysql_ping(mysql->conn)) {
 				if (mysql_errno(mysql->conn) == 2006) {
+					if (connect_charset != NULL) {
+						mysql_options(mysql->conn, MYSQL_SET_CHARSET_NAME, connect_charset);
+					}
 #ifndef MYSQL_USE_MYSQLND
 					if (mysql_real_connect(mysql->conn, host, user, passwd, NULL, port, socket, client_flags)==NULL)
 #else
@@ -976,6 +988,10 @@
 			mysql_options(mysql->conn, MYSQL_OPT_CONNECT_TIMEOUT, (const char *)&connect_timeout);
 		}
 
+		if (connect_charset != NULL) {
+			mysql_options(mysql->conn, MYSQL_SET_CHARSET_NAME, connect_charset);
+		}
+
 #ifndef MYSQL_USE_MYSQLND
 		if (mysql_real_connect(mysql->conn, host, user, passwd, NULL, port, socket, client_flags)==NULL)
 #else
--- ext/mysql/php_mysql_structs.h	2013-12-10 20:04:57.000000000 +0100
+++ ext/mysql/php_mysql_structs.h	2014-03-12 15:15:36.000000000 +0100
@@ -118,6 +118,7 @@
 	long default_port;
 	char *default_host, *default_user, *default_password;
 	char *default_socket;
+	char *connect_charset;
 	char *connect_error;
 	long connect_errno;
 	long connect_timeout;
--- ext/mysqli/mysqli.c	2013-12-10 20:04:57.000000000 +0100
+++ ext/mysqli/mysqli.c	2014-03-12 15:15:36.000000000 +0100
@@ -543,6 +543,7 @@
 #else
 	STD_PHP_INI_ENTRY("mysqli.default_socket",			NULL,	PHP_INI_ALL,		OnUpdateStringUnempty,	default_socket,	zend_mysqli_globals,		mysqli_globals)
 #endif
+	STD_PHP_INI_ENTRY("mysqli.connect_charset",         NULL,   PHP_INI_ALL,        OnUpdateString,     connect_charset,    zend_mysqli_globals,        mysqli_globals)
 	STD_PHP_INI_BOOLEAN("mysqli.reconnect",				"0",	PHP_INI_SYSTEM,		OnUpdateLong,		reconnect,			zend_mysqli_globals,		mysqli_globals)
 	STD_PHP_INI_BOOLEAN("mysqli.allow_local_infile",	"1",	PHP_INI_SYSTEM,		OnUpdateLong,		allow_local_infile,	zend_mysqli_globals,		mysqli_globals)
 PHP_INI_END()
@@ -564,6 +565,7 @@
 	mysqli_globals->default_user = NULL;
 	mysqli_globals->default_pw = NULL;
 	mysqli_globals->default_socket = NULL;
+	mysqli_globals->connect_charset = NULL;
 	mysqli_globals->reconnect = 0;
 	mysqli_globals->report_mode = 0;
 	mysqli_globals->report_ht = 0;
--- ext/mysqli/mysqli_nonapi.c	2013-12-10 20:04:57.000000000 +0100
+++ ext/mysqli/mysqli_nonapi.c	2014-03-12 15:15:36.000000000 +0100
@@ -61,7 +61,7 @@
 	MY_MYSQL			*mysql = NULL;
 	MYSQLI_RESOURCE		*mysqli_resource = NULL;
 	zval				*object = getThis();
-	char				*hostname = NULL, *username=NULL, *passwd=NULL, *dbname=NULL, *socket=NULL;
+	char				*hostname = NULL, *username=NULL, *passwd=NULL, *dbname=NULL, *socket=NULL, *connect_charset=NULL;
 	int					hostname_len = 0, username_len = 0, passwd_len = 0, dbname_len = 0, socket_len = 0;
 	zend_bool			persistent = FALSE;
 	long				port = 0, flags = 0;
@@ -127,6 +127,11 @@
 	if (!socket_len || !socket) {
 		socket = MyG(default_socket);
 	}
+
+	connect_charset = MyG(connect_charset);
+	if (connect_charset != NULL) {
+		mysql_options(mysql->mysql, MYSQL_SET_CHARSET_NAME, connect_charset);
+	}
 	if (!port){
 		port = MyG(default_port);
 	}
--- ext/mysqli/php_mysqli_structs.h	2013-12-10 20:04:57.000000000 +0100
+++ ext/mysqli/php_mysqli_structs.h	2014-03-12 15:15:36.000000000 +0100
@@ -291,6 +291,7 @@
 	char			*default_user;
 	char			*default_socket;
 	char			*default_pw;
+	char			*connect_charset;
 	long			reconnect;
 	long			allow_local_infile;
 	long			strict;
--- ext/pdo_mysql/mysql_driver.c	2013-12-10 20:04:57.000000000 +0100
+++ ext/pdo_mysql/mysql_driver.c	2014-03-12 15:15:36.000000000 +0100
@@ -566,6 +566,7 @@
 	pdo_mysql_db_handle *H;
 	int i, ret = 0;
 	char *host = NULL, *unix_socket = NULL;
+	char *connect_charset = NULL;
 	unsigned int port = 3306;
 	char *dbname;
 	struct pdo_data_src_parser vars[] = {
@@ -758,6 +759,11 @@
 		unix_socket = vars[4].optval;  
 	}
 
+	connect_charset = PDO_MYSQL_G(connect_charset);
+	if (connect_charset != NULL) {
+		mysql_options(H->server, MYSQL_SET_CHARSET_NAME, connect_charset);
+	}
+
 	/* TODO: - Check zval cache + ZTS */
 #ifdef PDO_USE_MYSQLND
 	if (dbname) {
--- ext/pdo_mysql/pdo_mysql.c	2013-12-10 20:04:57.000000000 +0100
+++ ext/pdo_mysql/pdo_mysql.c	2014-03-12 15:15:36.000000000 +0100
@@ -66,6 +66,7 @@
 #if PDO_DBG_ENABLED
 	STD_PHP_INI_ENTRY("pdo_mysql.debug",	NULL, PHP_INI_SYSTEM, OnUpdateString, debug, zend_pdo_mysql_globals, pdo_mysql_globals)
 #endif
+	STD_PHP_INI_ENTRY("pdo_mysql.connect_charset",		NULL,	PHP_INI_ALL,	OnUpdateStringUnempty,		connect_charset,	zend_pdo_mysql_globals,		pdo_mysql_globals)
 PHP_INI_END()
 /* }}} */
 
@@ -175,6 +176,7 @@
 	pdo_mysql_globals->debug = NULL;	/* The actual string */
 	pdo_mysql_globals->dbg = NULL;	/* The DBG object*/
 #endif
+	pdo_mysql_globals->connect_charset = NULL;
 }
 /* }}} */
 
--- ext/pdo_mysql/php_pdo_mysql_int.h	2013-12-10 20:04:57.000000000 +0100
+++ ext/pdo_mysql/php_pdo_mysql_int.h	2014-03-12 15:15:36.000000000 +0100
@@ -78,6 +78,7 @@
 	 */
 	void *dummymemmber;
 #endif
+	char *connect_charset;
 ZEND_END_MODULE_GLOBALS(pdo_mysql)
 
 ZEND_EXTERN_MODULE_GLOBALS(pdo_mysql)

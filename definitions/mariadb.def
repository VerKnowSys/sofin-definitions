DEF_FULL_NAME="MariaDB 10.1"
DEF_STANDALONE=YES
DEF_SHA="a7780f4b36fcf0f9c0e75af0b3b05e6fdf754044"
DEF_NAME="mariadb"
DEF_VERSION="10.1.34"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.gz"
DEF_REQUIREMENTS="pkgconf make lz4 gettext libedit libnet lua51 pcre libressl perl yasm libxml2 python27 ninja cmake msgpack kytea libsodium zeromq4 libevent"
DEF_CONFIGURE_METHOD="cmake"
DEF_CONFIGURE_ARGS="-DBUILD_CONFIG=mysql_release -DINSTALL_INCLUDEDIR=include/mysql -DINSTALL_INFODIR=share/info -DINSTALL_MYSQLSHAREDIR=share/mysql -DMYSQL_MAINTAINER_MODE=OFF -DINSTALL_SCRIPTDIR=bin -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DENABLED_LOCAL_INFILE=ON -DENABLE_DEBUG_SYNC=OFF -DWITH_SAFEMALLOC=OFF -DWITH_UNIT_TESTS=OFF -DWITH_VALGRIND=OFF -DWITH_LIBWRAP=OFF -DWITH_INNODB_LZ4=DYNAMIC -DGRN_WITH_LZ4=DYNAMIC -DWITH_INNODB_BZIP2=DYNAMIC -DWITH_INNODB_LZMA=DYNAMIC -DWITH_INNODB_LZO=DYNAMIC -DINSTALL_SYSCONFDIR=${SERVICE_DIR}/etc -DTMPDIR=/tmp -DMYSQL_DATADIR=${SERVICE_DIR}/data -DWITH_SSL=yes -DWITH_INNODB_DISALLOW_WRITES=ON -DENABLED_PROFILING=OFF -DCOMPILATION_COMMENT=VerKnowSys -DSECURITY_HARDENED=ON -DPLUGIN_MROONGA=NO -DPLUGIN_TOKUDB=NO -DPLUGIN_DAEMON_EXAMPLE=NO -DCMAKE_OSX_ARCHITECTURES=x86_64 -DHAVE_STDCXX11=YES -DWITH_EMBEDDED_SERVER=ON -DPLUGIN_SEQUENCE=DYNAMIC -DPLUGIN_PERFSCHEMA=DYNAMIC -DPLUGIN_PARTITION=DYNAMIC -DPLUGIN_FEEDBACK=DYNAMIC -DPLUGIN_ARIA=DYNAMIC -DPLUGIN_AUTH_GSSAPI_CLIENT=NO -DCMAKE_SKIP_BUILD_RPATH=YES -DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 -DWITH_FAST_MUTEXES=1 -DWITH_JEMALLOC=system -DWITH_PCRE=system -DWITH_ZLIB=system"
DEF_EXPORTS="mysql mysqld_multi mysqld mysqld_safe mysql_config mysqladmin mysqlimport mysqlbinlog mysqldump mysqlaccess mysqlcheck mysqlhotcopy mysql_upgrade mysql_install_db msql2mysql myisamchk myisamlog myisampack mysqltest mysqlslap mysqldumpslow mysqlbug mysql_zap mysql_waitpid mysql_tzinfo_to_sql mysql_setpermission mysql_secure_installation mysql_plugin mysql_fix_extensions mysql_find_rows mysql_convert_table_format mysql_client_test my_print_defaults myisam_ftdump innochecksum aria_chk aria_dump_log aria_ftdump aria_pack aria_read_log mytop perror mysqlshow mysql-proxy"
DEF_USELESS="share/bison share/gdb share/libtool doc sql-bench support-files data share/cmake* man lib/*perl* include/python* lib/python* doc docs sql-bench share/cmake* share/gtk* share/glib* share/man INSTALL-BINARY README COPYING share/gettext share/*.sql share/lua COPYING.LESSER COPYING.thirdparty CREDITS EXCEPTIONS-CLIENT README-wsrep scripts libexec lib/lua mysql-test include/boost"
DEF_USEFUL="bin/my*" # always be prepared for more ;)
DEF_NO_CCACHE=YES
DEF_USE_SAFE_STACK=YES
DEF_CONFLICTS_WITH="Percona Mysql"
DEF_AFTER_PATCH_METHOD="sed_stuff"
sed_stuff () {
    ${SED_BIN} -i '' -e "s|%%LOCALBASE%%|${PREFIX}|g" scripts/mysql_config.sh
    ${SED_BIN} -i '' -e "s|%%PREFIX%%|${PREFIX}|g" mysys/my_default.c
    return 0
}
DEF_AFTER_BUILD_METHOD="make_sure_data_dir_exists_or_create_it"
make_sure_data_dir_exists_or_create_it () {
    for _dir in etc tmp data var/log; do
        try "${MKDIR_BIN} -p ${SERVICE_DIR}/${_dir}"
    done
}
case "${SYSTEM_NAME}" in
    FreeBSD)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} -DSECURITY_HARDENED=ON"
        ;;
esac

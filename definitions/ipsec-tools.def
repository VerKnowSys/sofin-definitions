APP_STANDALONE="true"
APP_FULL_NAME="IPSEC Tools"
APP_NAME="ipsec-tools"
APP_SHA="7d92cae9fde59fb4f125636698c43b0a3df3d0f0"
APP_VERSION="0.8.2"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.bz2"
APP_REQUIREMENTS="libiconv"
APP_CONFIGURE_ARGS="--enable-ipv6 --disable-adminport --enable-stats --enable-dpd --enable-natt=kernel --enable-security-context=kernel --enable-frag --enable-hybrid --without-libpam --disable-gssapi --sysconfdir=${SOFTWARE_DATA_DIR}/etc/racoon --localstatedir=${SOFTWARE_DATA_DIR}/var --with-libradius --without-libldap --with-openssl --with-libiconv"
APP_AFTER_UNPACK_CALLBACK="unpack_callback"
APP_AFTER_CONFIGURE_CALLBACK="afterconfig_callback"
APP_EXPORTS="plainrsa-gen racoon racoonctl setkey"
FORCE_GNU_COMPILER="true"

unpack_callback () {
    note "$(pwd)"
    ${SED_BIN} -i '' -e 's#-Werror##g' configure
    ${SED_BIN} -i '' -e 's#-R$libdir#-Wl,-rpath=$libdir#g' configure
    ${SED_BIN} -i '' -e "s#yes/lib#${PREFIX}/lib#g" configure
}

afterconfig_callback () {
    for makefile in $(${FIND_BIN} . -name 'Makefile'); do
        ${SED_BIN} -i '' -e 's#-R$libdir#-Wl,-rpath=$libdir#g' ${makefile}
        ${SED_BIN} -i '' -e "s#-Lyes/lib#-L${PREFIX}/lib#g" ${makefile}
    done
}

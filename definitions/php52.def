. ${DEFINITIONS_DIR}php56.def

DISABLE_ON="FreeBSD Darwin"
APP_FULL_NAME="PHP 5.2"
APP_SHA="d68f3b09f766990d815a3c4c63c157db8dab8095"
APP_VERSION="5.2.17"
APP_POSTFIX="52"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.bz2"
APP_CONFIGURE_SCRIPT="export FREETYPE2_DIR=${PREFIX} && export FREETYPE2_INC_DIR=${PREFIX}/include/freetype2 && ./configure"
APP_CONFIGURE_ARGS="$(echo "${APP_CONFIGURE_ARGS}" | ${SED_BIN} -e "s/--with-kerberos/--without-kerberos/") --with-freetype-dir=${PREFIX} --enable-spl --with-mysql=${PREFIX} --with-mysqli=${PREFIX}/bin/mysql_config --with-pcre-regex --with-pcre-dir=${PREFIX} --with-gd"
APP_COMPILER_ARGS="-I${PREFIX}/include -I${PREFIX}/include/freetype2 -I/usr/include"
APP_LINKER_ARGS="-L${PREFIX}/lib"
APP_REQUIREMENTS="$(echo "${APP_REQUIREMENTS} autoconf213 php52-cgi" | ${SED_BIN} -e 's/libressl/openssl/;s/ gd//')" # NOTE: this autoconf23 is required here, cause php 5.2 buildconf script requires that to generate configure script correctly. Also newer version is required earlier by gmp..
APP_MAKE_METHOD="gmake -s"
APP_INSTALL_METHOD="gmake install -s"

APP_AFTER_UNPACK_CALLBACK="hack_after_unpack"
hack_after_unpack () {
    ${MKDIR_BIN} -p ${PREFIX}/Software
    ${LN_BIN} -s ${PREFIX} ${PREFIX}/Software || true
    test -d /tmp/pear && ${RM_BIN} -fr /tmp/pear

    debug "Fetching Litespeed SAPI" && \
    ${FETCH_BIN} ${MAIN_SOURCE_REPOSITORY}php-litespeed-5.5.tgz && \
    ${TAR_BIN} xf php-litespeed-5.5.tgz --directory sapi/

    debug "Fixing GMP definition name"
    ${SED_BIN} -i 's/__GMP_BITS_PER_MP_LIMB/GMP_LIMB_BITS/g' ext/gmp/gmp.c

    debug "Regenerating configure script"
    touch ac*
    PATH=${PREFIX}/bin:/bin:/usr/bin:/usr/sbin:/sbin ./buildconf --force
}
APP_AFTER_CONFIGURE_CALLBACK="${RM_BIN} -rf ${PREFIX}/Software || true"
# Php 5.2-5.3 extension version:
install_xdebug () {
    arch_name="xdebug-2.2.7"
    archive="${arch_name}.tgz"
    ${FETCH_BIN} "${MAIN_SOURCE_REPOSITORY}${archive}" && \
    ${TAR_BIN} xf "${archive}" && \
    cd "${arch_name}" && \
    ${PREFIX}/bin/phpize && \
    ./configure --prefix=${PREFIX} --enable-xdebug --with-php-config=${PREFIX}/bin/php-config && \
    PATH=${PREFIX}/bin:$PATH make install && \
    note "Installed Xdebug pecl module: v2.2.7" && \
    return 0
    return 1
}


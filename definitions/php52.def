inherit php56

DEF_DISABLE_ON="FreeBSD Darwin"
DEF_FULL_NAME="PHP 5.2"
DEF_SHA="d68f3b09f766990d815a3c4c63c157db8dab8095"
DEF_VERSION="5.2.17"
DEF_POSTFIX="52"
DEF_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.bz2"
DEF_CONFIGURE="export FREETYPE2_DIR=${PREFIX} && export FREETYPE2_INC_DIR=${PREFIX}/include/freetype2 && ./configure"
DEF_CONFIGURE_ARGS="$(echo "${APP_CONFIGURE_ARGS}" | ${SED_BIN} -e "s/--with-kerberos/--without-kerberos/") --with-freetype-dir=${PREFIX} --enable-spl --with-mysql=${PREFIX} --with-mysqli=${PREFIX}/bin/mysql_config --with-pcre-regex --with-pcre-dir=${PREFIX} --with-gd"
DEF_COMPILER_ARGS="-I${PREFIX}/include -I${PREFIX}/include/freetype2 -I/usr/include"
DEF_LINKER_ARGS="-L${PREFIX}/lib"
DEF_REQUIREMENTS="$(echo "${APP_REQUIREMENTS} autoconf213 php52-cgi" | ${SED_BIN} -e 's/libressl/openssl/;s/ gd//')" # NOTE: this autoconf23 is required here, cause php 5.2 buildconf script requires that to generate configure script correctly. Also newer version is required earlier by gmp..
DEF_MAKE_METHOD="gmake -s"
DEF_INSTALL_METHOD="gmake install -s"
DEF_BUNDLED_EXTENSIONS="$(echo "${APP_BUNDLED_EXTENSIONS}" | ${SED_BIN} -e 's/phalcon2//;s/phalcon//') apc phar opcache" # XXX: +phalcon, which cannot be built here right away, cause of autoconf213 old mess..

hack_after_unpack () {
    ${MKDIR_BIN} -p ${PREFIX}/Software
    ${LN_BIN} -s ${PREFIX} ${PREFIX}/Software || true
    test -d /tmp/pear && ${RM_BIN} -fr /tmp/pear

    debug "Fetching Litespeed SAPI" && \
    ${FETCH_BIN} ${MAIN_SOURCE_REPOSITORY}php-litespeed-5.5.tgz && \
    ${TAR_BIN} xf php-litespeed-5.5.tgz --directory sapi/

    debug "Fixing GMP definition name"
    ${SED_BIN} -i 's/__GMP_BITS_PER_MP_LIMB/GMP_LIMB_BITS/g' ext/gmp/gmp.c

    debug "Regenerating configure script"
    touch ac*
    PATH=${PREFIX}/bin:/bin:/usr/bin:/usr/sbin:/sbin ./buildconf --force
}
DEF_AFTER_CONFIGURE_CALLBACK="${RM_BIN} -rf ${PREFIX}/Software || true"


# Php 5.2-5.3 extension version:
install_xdebug () {
    arch_name="xdebug-2.2.7"
    archive="${arch_name}.tgz"
    ${FETCH_BIN} "${MAIN_SOURCE_REPOSITORY}${archive}" && \
    ${TAR_BIN} xf "${archive}" && \
    cd "${arch_name}" && \
    ${PREFIX}/bin/phpize && \
    ./configure --prefix=${PREFIX} --enable-xdebug --with-php-config=${PREFIX}/bin/php-config && \
    PATH=${PREFIX}/bin:$PATH make install && \
    note "Installed PECL extension: ${arch_name}" && \
    return 0
    return 1
}

# Php 5.2-5.3 extension version:
install_imagick () {
    arch_name="imagick-3.1.2"
    archive="${arch_name}.tgz"
    ${FETCH_BIN} "${MAIN_SOURCE_REPOSITORY}${archive}" && \
    ${TAR_BIN} xf "${archive}" && \
    cd "${arch_name}" && \
    ${PREFIX}/bin/phpize && \
    ./configure --prefix=${PREFIX} --with-imagick=${PREFIX} --with-php-config=${PREFIX}/bin/php-config && \
    PATH=${PREFIX}/bin:$PATH make install && \
    note "Installed PECL extension: ${arch_name}" && \
    return 0
    return 1
}

DEF_DISABLE_ON="Minix"
DEF_FULL_NAME="Perl"
DEF_SHA="19b218bbc3a63a8408ed56b93928fd9a4c1b5c83"
DEF_NAME="perl"
DEF_VERSION="5.24.1"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.gz"
DEF_REQUIREMENTS="pkgconf make lzma xz lzo lz4 libressl"
DEF_STANDALONE=YES
DEF_AFTER_PATCH_METHOD="patch_Configure"
patch_Configure () {
    ${SED_BIN} -i '' -e "s#/usr/local#${PREFIX}#g" ./Configure
}
DEF_AFTER_CONFIGURE_METHOD="patch_Makefile"
patch_Makefile () {
    if [ "${SYSTEM_NAME}" = "FreeBSD" ]; then
        ${SED_BIN} -i '' -e "s#-lpthread -lm -lcrypt -lutil#-lpthread -lm -lcrypt -lutil -fsanitize=safe-stack#g" ./Makefile
    fi
}
DEF_CONFIGURE_METHOD="./Configure"
DEF_CONFIGURE_ARGS="-des -Doptimize='-I${PREFIX}/include ${CFLAGS}' -Dprefix=${PREFIX} -Dinstallusrbinperl=n -Dusethreads=y -Dusemymalloc=n -Duse64bitint=y -Duseshrplib=n -Ui_malloc -Ui_iconv -Dscriptdir=${PREFIX}/bin -Dusenm=n -Dinc_version_list=none -Dusemultiplicity=y -Dcf_by=VerKnowSys"
DEF_EXPORTS="perl cpan cpan2dist cpanp config_data piconv psed prove pstruct ptar ptardiff shasum pl2pm"
DEF_NO_TRAP_INT_OVERFLOW=YES
DEF_NO_FAST_MATH=YES
DEF_NO_CCACHE=YES
DEF_NO_LTO=YES
DEF_MAKE_METHOD="make_method"
make_method () {
    locale_cleanup
    note "Make!"
    make -j"${CPUS}"
}
DEF_INSTALL_METHOD="install_method"
install_method () {
    locale_cleanup
    make -s install
}

locale_cleanup () {
    CC="cc"
    CXX="c++"
    LANG=""
    LC_ALL=""
    LC_COLLATE=""
    LC_CTYPE=""
    LC_MESSAGES=""
    LC_MONETARY=""
    LC_NUMERIC=""
    LC_TIME=""
}

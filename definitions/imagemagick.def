DEF_FULL_NAME="ImageMagick Graphics Library"
DEF_SHA="5965e9ba6d8c69ff702d1ed3e60bdb218ad2851e"
DEF_NAME="ImageMagick"
DEF_VERSION="7.0.7-22"
DEF_ORIGIN="https://www.imagemagick.org/download/"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_REQUIREMENTS="pkgconf m4 make libunistring zlib bzip2 lzma xz lzo pcre libffi gettext python27 libtool libressl perl autoconf texinfo automake14 bison util-macros cups expat libpaper libidn ghostscript libpng libjpeg-turbo nasm jpeg jbig2dec jbigkit nasm tiff lcms2 freetype fontconfig freefont sharefont jasper fftw"
DEF_CONFIGURE_ARGS="--with-lzma=${PREFIX} --without-perl --with-threads --with-fftw"
DEF_INSTALL_METHOD="make -s install"
DEF_USEFUL="bin/magick* bin/pkgconf bin/pkg-config bin/gsbj bin/gsdj bin/gsdj500 bin/gslj bin/gslp bin/gsnd"
DEF_USELESS="lib/*perl* lib/*python* share/examples share/info share/bison share/info share/examples share/doc share/ac* share/auto* share/libtool man lib/cmake lib/*.sh share/texinfo share/util-macros"
DEF_EXPORTS="magick convert display identify animate compare composite conjure mogrify montage thumbnail stream Magick++-config Magick-config MagickWand-config MagickCore-config Wand-config"
DEF_CONFLICTS_WITH="GraphicsMagick"
DEF_USE_SAFE_STACK=YES

DEF_AFTER_CONFIGURE_METHOD="fix_makefile"
fix_makefile () {
    ${SED_BIN} -i '' -e \
        '/7.Q16HDRI.pc/d ; /cp -f\ \$\^\ \$\@/d' \
        Makefile
    true
}

DEF_AFTER_INSTALL_METHOD="use_bundled_pkgconf"
use_bundled_pkgconf () {
    ${SED_BIN} -i '' -e \
        "s:pkg-config:${PREFIX}/bin/pkgconf:g" \
        "${PREFIX}/bin/Magick++-config" \
        "${PREFIX}/bin/Magick-config" \
        "${PREFIX}/bin/MagickCore-config" \
        "${PREFIX}/bin/MagickWand-config" \
        "${PREFIX}/bin/Wand-conf"ig
    true
}

APP_FULL_NAME="PHP"
APP_SHA="3c999036d4e55ae5b701490ca938d0bed12e6bdd"
APP_NAME="php"
APP_VERSION="5.6.2"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.bz2"
APP_CONFIGURE_SCRIPT="./configure"
APP_CONFIGURE_ARGS="--disable-all --with-libdir=${PREFIX}/lib --with-layout=PHP --with-libxml-dir=${PREFIX} --with-pcre-dir=${PREFIX} --with-zlib-dir=${PREFIX} --with-gettext=${PREFIX} --with-gd --with-png-dir=${PREFIX} --with-jpeg-dir=${PREFIX} --enable-exif --enable-zip --enable-mysqlnd --without-apache --disable-debug --enable-fpm --enable-sockets --enable-soap --enable-json --enable-libxml --enable-dom --enable-cli --enable-session --enable-hash --enable-simplexml --enable-xml --enable-filter --enable-pdo --with-pdo-mysql=${PREFIX} --with-pdo-pgsql=${PREFIX} --enable-mbstring --enable-fileinfo --with-openssl --enable-intl --with-mcrypt=${PREFIX} --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-openssl-dir=${PREFIX} --with-pgsql=${PREFIX} --with-config-file-path=${PREFIX} --with-curl=${PREFIX} --with-gmp=${PREFIX} --with-freetype-dir=${PREFIX} --with-pear --with-xsl=${PREFIX} --enable-posix --with-bz2 --enable-ftp --enable-calendar --enable-bcmath --enable-wddx --enable-zip --enable-intl --with-mssql=${PREFIX} --with-imap-ssl --with-xmlrpc --with-kerberos --with-apxs2=${PREFIX}/bin/apxs --with-iconv"
APP_REQUIREMENTS="gmake perl libiconv pkgconf zlib gettext bzip2 m4 autoconf bison flex postgresql libxml2 libtool libgpg-error libgcrypt libxslt pcre libexif libpng jpeg freetype fontconfig gd cmake ncurses mysql icu libmcrypt openssl curl gmp tiff jasper imagemagick freetds apr apr-util httpd"
APP_EXPORTS="php php-fpm php-config phpize pecl"

# install extensions
APP_AFTER_INSTALL_CALLBACK="install_extensions"

# HACK: Required to detect freetds (don't blame me, but Php/TDS guys for messed up library detection)
APP_AFTER_UNPACK_CALLBACK="${MKDIR_BIN} -p ${PREFIX}/Software ; ${LN_BIN} -s ${PREFIX} ${PREFIX}/Software || true"
APP_AFTER_CONFIGURE_CALLBACK="${RM_BIN} -rf ${PREFIX}/Software || true"


install_imagick () {
    PATH=$PATH:${PREFIX}/bin echo ${PREFIX} | ${PREFIX}/bin/pecl install imagick
    test "$?" = "0" || error "Error building imagick"
}

install_rar () {
    PATH=$PATH:${PREFIX}/bin echo ${PREFIX} | ${PREFIX}/bin/pecl install rar
    test "$?" = "0" || error "Error building rar"
}

install_phalcon () {
    ${GIT_BIN} clone --depth=1 git://github.com/phalcon/cphalcon.git
    cd cphalcon/build
    PATH=${PREFIX}/bin:$PATH ./install
    test "$?" = "0" || error "Error building cphalcon"
}

install_extensions () {
    install_imagick
    install_rar
    install_phalcon
    ${CP_BIN} -v ${PREFIX}/lib/php/extensions/no-debug-zts-*/* ${PREFIX}/lib/php/extensions
}

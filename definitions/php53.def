. ${DEFINITIONS_DIR}php52.def

DISABLE_ON="FreeBSD Darwin"
APP_FULL_NAME="PHP 5.3"
APP_SHA="6e9e492c6d5853d063ddb9a4dbef60b8e5d87444"
APP_VERSION="5.3.29"
APP_POSTFIX="53"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.bz2"
APP_REQUIREMENTS="$(echo "${APP_REQUIREMENTS}" | ${SED_BIN} -e 's/php52-cgi/php53-cgi/')"
APP_CONFIGURE_ARGS="${APP_CONFIGURE_ARGS} --with-openssl=${PREFIX} --disable-fpm --without-cgi --without-apxs2"

if [ "${SYSTEM_NAME}" = "FreeBSD" ]; then
    # on the fly patch for stdc++
    add_libstdc_to_makefile () {
        ${SED_BIN} -i '' -e 's:^EXTRA_LIBS = :EXTRA_LIBS = -lstdc++ :' Makefile
    }
    APP_AFTER_CONFIGURE_CALLBACK="${APP_AFTER_CONFIGURE_CALLBACK}; add_libstdc_to_makefile"
fi

install_rar () {
    arch_name="rar-3.0.2"
    archive="${arch_name}.tgz"
    ${FETCH_BIN} "${MAIN_SOURCE_REPOSITORY}${archive}" && \
    ${TAR_BIN} xf "${archive}" && \
    cd "${arch_name}" && \
    export PATH=${PREFIX}/bin:/bin:/usr/bin:/sbin:/usr/sbin && \
    ${PREFIX}/bin/phpize && \
    ./configure --prefix=${PREFIX} --disable-static --enable-shared --enable-rar --with-php-config=${PREFIX}/bin/php-config && \
    PATH=${PREFIX}/bin:$PATH make install && \
    note "Installed Rar pecl module: ${arch_name}" && \
    return 0
    return 1
}

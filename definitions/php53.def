inherit php52

DEF_DISABLE_ON="FreeBSD Darwin"
DEF_FULL_NAME="PHP 5.3"
DEF_SHA="6e9e492c6d5853d063ddb9a4dbef60b8e5d87444"
DEF_VERSION="5.3.29"
DEF_POSTFIX="53"
DEF_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.bz2"
DEF_REQUIREMENTS="$(echo "${DEF_REQUIREMENTS}" | ${SED_BIN} -e 's/php52-cgi/php53-cgi/')"
DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --with-openssl=${PREFIX} --disable-fpm --without-cgi --without-apxs2"

# on the fly patch for stdc++
add_libstdc_to_makefile () {
    ${SED_BIN} -i '' -e 's:^EXTRA_LIBS = :EXTRA_LIBS = -lstdc++ :' Makefile
    true
}
DEF_AFTER_CONFIGURE_CALLBACK="${DEF_AFTER_CONFIGURE_CALLBACK}; add_libstdc_to_makefile"

install_rar () {
    arch_name="rar-3.0.2"
    archive="${arch_name}.tgz"
    ${FETCH_BIN} "${MAIN_SOURCE_REPOSITORY}${archive}" && \
    ${TAR_BIN} xf "${archive}" && \
    cd "${arch_name}" && \
    export PATH=${PREFIX}/bin:/bin:/usr/bin:/sbin:/usr/sbin && \
    ${PREFIX}/bin/phpize && \
    ./configure --prefix=${PREFIX} --disable-static --enable-shared --enable-rar --with-php-config=${PREFIX}/bin/php-config && \
    PATH=${PREFIX}/bin:$PATH make install && \
    note "Installed Rar pecl module: ${arch_name}" && \
    return 0
    return 1
}

hack_after_unpack () {
    ${MKDIR_BIN} -p ${PREFIX}/Software
    ${LN_BIN} -s ${PREFIX} ${PREFIX}/Software || true
    test -d /tmp/pear && ${RM_BIN} -fr /tmp/pear

    debug "Fetching Litespeed SAPI" && \
    ${FETCH_BIN} ${MAIN_SOURCE_REPOSITORY}php-litespeed-6.7.tgz && \
    ${TAR_BIN} xf php-litespeed-6.7.tgz --directory sapi/

    debug "Regenerating configure script"
    touch ac*
    PATH=${PREFIX}/bin:/bin:/usr/bin:/usr/sbin:/sbin ./buildconf --force
}

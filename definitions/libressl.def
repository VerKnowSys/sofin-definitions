DISABLE_ON="Minix"
APP_FULL_NAME="LibreSSL Library"
APP_SHA="87e9d5589a1e4f29e3417fcde28fe01a7783eb2c"
APP_NAME="libressl"
APP_VERSION="2.3.6"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.gz"
APP_EXPORTS="openssl"

cacert_source="http://curl.haxx.se/ca/cacert.pem"
cacert_source_alt="http://raw.githubusercontent.com/bagder/ca-bundle/master/ca-bundle.crt"
os_specific="${SERVICE_DIR}"
safety_opts="--no-verify-peer"
case "${SYSTEM_NAME}" in
    Linux)
        os_specific="${PREFIX}"
        safety_opts="--no-check-certificate"
        ;;

    Darwin)
        safety_opts=""
        ;;
esac

APP_AFTER_INSTALL_CALLBACK="create_cert_file"
create_cert_file () {
    ${MKDIR_BIN} -p ${os_specific}/etc/ssl
    cd ${os_specific}/etc/ssl
    # 1st try:
    ${FETCH_BIN} ${safety_opts} ${cacert_source} -o ${os_specific}/etc/ssl/cert.pem || \
    # 2nd try:
    ${FETCH_BIN} ${safety_opts} ${cacert_source_alt} -o ${os_specific}/etc/ssl/cert.pem || \
    ${TEST_BIN} -f /etc/ssl/cert.pem || \
    error "Couldn't fetch recent cert.pem"
}

DEF_DISABLE_ON="Minix"
DEF_FULL_NAME="LibreSSL Library"
DEF_SHA="b3e8b7b8d70aa27459add8ee4ab5078b366923d2"
DEF_NAME="libressl"
DEF_VERSION="2.5.1"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.gz"
DEF_EXPORTS="openssl"
DEF_ORIGIN="https://ftp.openbsd.org/pub/OpenBSD/LibreSSL"
DEF_NO_SAFE_STACK=YES
cacert_source_alt="http://raw.githubusercontent.com/bagder/ca-bundle/master/ca-bundle.crt"
os_specific="${SERVICE_DIR}"
unset safety_opts
case "${SYSTEM_NAME}" in
    Linux)
        os_specific="${PREFIX}"
        safety_opts="--no-check-certificate"
        ;;

    Darwin)
        safety_opts=""
        ;;
esac

DEF_AFTER_INSTALL_METHOD="fetch_ca_cert"
fetch_ca_cert () {
    ${MKDIR_BIN} -p ${SERVICE_DIR}/etc/ssl
    ${RM_BIN} -vf ${SERVICE_DIR}/etc/ssl/cert.pem
    ${FETCH_BIN} -o ${SERVICE_DIR}/etc/ssl/cert.pem ${FETCH_OPTS} ${DEF_CA_ROOTCERT_ORIGIN} || \
        ${FETCH_BIN} -o ${SERVICE_DIR}/etc/ssl/cert.pem ${FETCH_OPTS} ${cacert_source_alt}
}

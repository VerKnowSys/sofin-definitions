inherit rustc

DEF_FULL_NAME="Cargo - Rust crate manager"
DEF_NAME="cargo"
DEF_GIT_MODE=YES
DEF_VERSION="1.x-master"
DEF_SOURCE_PATH="https://github.com/rust-lang/cargo.git"
DEF_REQUIREMENTS="${DEF_REQUIREMENTS} rustc"
DEF_CONFIGURE_ARGS="--local-rust-root=${PREFIX} --enable-optimize"
DEF_EXPORTS="cargo cargo.bin"

DEF_AFTER_INSTALL_METHOD="make_wrapper"
make_wrapper () {
    # make wrapper for cargo which does not include rpath information in binary:
    ${MV_BIN} ${PREFIX}/bin/cargo ${PREFIX}/bin/cargo.bin
    if [ "Darwin" = "${SYSTEM_NAME}" ]; then
        _addon="DY"
    fi
    ${PRINTF_BIN} "#\!/bin/sh\n${_addon}LD_LIBRARY_PATH=${PREFIX}/lib ${PREFIX}/bin/cargo.bin \$*\n" > ${PREFIX}/bin/cargo
    ${CHMOD_BIN} 755 ${PREFIX}/bin/cargo
}

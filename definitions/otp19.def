DEF_FULL_NAME="Erlang OTP"
DEF_SHA="3be958b529de4be19d77eb77f587a76210b43bfd"
DEF_NAME="otp"
DEF_VERSION="19.0"
DEF_POSTFIX="19"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}_src_${DEF_VERSION}.tar.gz"
DEF_REQUIREMENTS="pkgconf make m4 db zlib lzma xz libunwind libatomic_ops perl autoconf libtool texinfo automake libressl unixodbc" # ncurses
DEF_INSTALL_METHOD="LANG=C make -s install && install_repl_history"
DEF_CONFIGURE_ARGS="--enable-m64-build --enable-threads --with-dynamic-trace=dtrace --enable-fp-exceptions --enable-hipe --enable-kernel-poll --enable-smp-support --enable-sctp --with-ssl=${PREFIX} --without-javac --disable-debug --enable-dynamic-ssl-lib --enable-shared-zlib --enable-vm-probes --with-odbc=${PREFIX} --disable-native-libs --with-libatomic_ops=${PREFIX} --disable-silent-rules"
DEF_EXPORTS="ct_run dialyzer epmd erl erlc escript run_erl to_erl typer"
DEF_CONFLICTS_WITH="Otp Elixir"
DEF_USELESS="lib/*perl* docs share"

case "${SYSTEM_NAME}" in
    FreeBSD)
        DEF_COMPILER_ARGS="-DMAP_NORESERVE=0"
        DEF_LINKER_ARGS="-L${PREFIX}/lib -L/usr/lib -ldtrace -lpthread"
        ;;

    *)
        ;;
esac

install_repl_history() {
    ${GIT_BIN} clone https://github.com/ferd/erlang-history.git
    cd erlang-history
    PATH=$PATH:${PREFIX}/bin:/bin make install
}

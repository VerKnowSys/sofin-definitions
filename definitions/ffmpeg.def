DEF_FULL_NAME="FFMPEG: Multimedia framework, able to decode, encode, transcode, mux, demux, stream, filter and play pretty much anything that humans and machines have created."
DEF_SHA="40bb9002df044514723e9cca7f0a049eee88fed8"
DEF_NAME="ffmpeg"
DEF_VERSION="4.1"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
_ffmpeg_configure_flags="--cc=cc --cxx=c++ --enable-pic --enable-lzo --enable-lzma --enable-openssl --enable-libwavpack --enable-libtwolame --enable-libsoxr --enable-libmp3lame --enable-ftrapv --enable-nonfree --enable-libopus --enable-libspeex --enable-libvorbis --disable-w32threads --disable-os2threads --disable-d3d11va --disable-devices --disable-doc --disable-htmlpages --disable-podpages --disable-txtpages --disable-debug --disable-xlib --disable-libtheora --disable-videotoolbox --disable-swscale-alpha --disable-videotoolbox --disable-vaapi --disable-vdpau --disable-d3d11va --disable-dxva2 --disable-valgrind-backtrace"
DEF_REQUIREMENTS="pkgconf make libatomic_ops m4 libtool zlib lzma lzo xz bzip2 nasm expat yasm pcre perl openssl10 python27 autoconf automake icu boost-static libffi gettext glib db sqlite fftw lame libid3tag mpg123 libcue jemalloc curl-minimal cmake libdca taglib yajl faad neon libogg libvorbis flac uriparser libxspf speex libao wavpack openal libsndfile twolame libbs2b texinfo libidn libmpcdec libsamplerate libmad libshout opus opus-tools faac audiofile soxr python36 libmpdclient mpc"
case "${SYSTEM_NAME}" in
    FreeBSD) # HardenedBSD
        DEF_CONFIGURE_ARGS="--enable-shared --enable-lto --disable-static --enable-rpath --extra-ldflags='-L${PREFIX}/lib -pie -fPIC'"
        DEF_COMPILER_FLAGS="${DEF_COMPILER_FLAGS} -Wl,-rpath,${PREFIX}/lib ${DEF_OPTFLAGS} -fsanitize=safe-stack"
        DEF_LINKER_FLAGS="${DEF_LINKER_FLAGS} -fsanitize=safe-stack"
        ;;

    Darwin)
        DEF_CONFIGURE_ARGS="--enable-lto --disable-rpath --disable-iconv"
        ;;

    *)
        DEF_CONFIGURE_ARGS="--enable-rpath"
        DEF_COMPILER_FLAGS="${DEF_COMPILER_FLAGS} -Wl,-rpath,${PREFIX}/lib ${DEF_OPTFLAGS}"
        ;;
esac
DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} ${_ffmpeg_configure_flags}"
DEF_USEFUL="bin/ff* bin/*conf* bin/sndfile-* bin/speex* bin/*lame bin/fftw* bin/wavpack bin/mpc bin/mpg123* bin/faa* bin/extract_* bin/dtsdec bin/dcadec bin/opus* bin/wv* bin/sf* bin/flac bin/openal-info"
DEF_EXPORTS="ffmpeg ffprobe ffserver"
DEF_STANDALONE=YES
DEF_USE_SAFE_STACK=YES

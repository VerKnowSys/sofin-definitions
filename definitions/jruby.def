DISABLE_ON="Darwin Linux"
APP_FULL_NAME="JRuby"
APP_NAME="jruby"
APP_SHA="2501e8fce104dc3918a60e613570124169fd4667"
APP_VERSION="9.0.1.0"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-bin-${APP_VERSION}.tar.gz"
APP_CONFIGURE_SCRIPT="binary"
APP_AFTER_UNPACK_CALLBACK="${CP_BIN} -fR ${CACHE_DIR}cache/${APP_NAME}-${APP_VERSION}-${RUNTIME_SHA}/${APP_NAME}-${APP_VERSION}/ ${PREFIX}"
APP_AFTER_INSTALL_CALLBACK="${FIND_BIN} ${PREFIX} -type f -name '*.dll' -o -name '*.exe' -o -name '*.bat' | ${XARGS_BIN} rm; ${LN_BIN} -s ${PREFIX}/bin/jruby ${PREFIX}/bin/ruby; ${PRINTF_BIN} 'gem: --no-ri --no-rdoc' > ${HOME}/.gemrc ; ${PREFIX}/bin/gem install bundler --force ; echo 'done'"
APP_REQUIREMENTS="openjdk8"
APP_USEFUL="bin/jdb bin/jhat bin/jinfo bin/jmap bin/jar bin/jps bin/jarsigner bin/jrunscript bin/policytool bin/java bin/jstack bin/registervm bin/classpath bin/javac bin/jstat bin/rmic bin/javadoc bin/jstatd bin/rmid bin/javah bin/keytool bin/rmiregistry bin/javap bin/javavm jcmd"
APP_EXPORTS="ast gem jgem irb jirb jruby jrubyc ri rdoc rake ruby bundle"
APP_ORIGIN="http://jruby.org/download"
APP_CONFLICTS_WITH="Rubinius Ruby Passenger"
APP_AFTER_INSTALL_CALLBACK="create_jruby_script"
APP_USELESS="demo sample samples src.zip THIRD_PARTY_* COPYING"

create_jruby_script () {
    cd ${PREFIX}/bin
    ${FETCH_BIN} https://raw.githubusercontent.com/jruby/jruby/master/bin/jruby.sh
    ${MV_BIN} -f jruby jruby.bash
    ${MV_BIN} jruby.sh jruby
    ${CHMOD_BIN} +x jruby

    # two little fixes for fbsd sh:
    ${SED_BIN} -i '' -e 's/\[\[/[/g;s/\]\]/]/g' jruby
    ${SED_BIN} -i '' -e '26,39d' jruby

    # set JRE and JRUBY HOME:
    ${SED_BIN} -i '' -e "s#PRG=\$0#export JAVA_HOME=${PREFIX}/jre; export JRUBY_HOME=${PREFIX} ; PRG=\$0#"  jruby
}

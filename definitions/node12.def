inherit "node"

DEF_VERSION="v12.4.0"
DEF_SHA="870147e78631181cda8ea2609575a30d0c686a0d"
DEF_FULL_NAME="Node.js ${DEF_VERSION%.*}-CURRENT"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_ORIGIN="https://nodejs.org/dist/${DEF_VERSION}/${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_CONFIGURE_ARGS="--tag=VerKnowSys --with-dtrace --with-intl=system-icu --openssl-system-ca-path=${SERVICE_DIR}/etc/ssl --openssl-use-def-ca-store --without-inspector --without-snapshot --without-etw --shared-zlib --shared-nghttp2 --shared-libuv --shared-cares"

DEF_AFTER_CONFIGURE_METHOD="node_patch_configured"
node_patch_configured () {
    permnote "Replacing: '/usr/local' with: '${PREFIX}', since /usr/local is hardcoded multiple times among Node source filesâ€¦"
    ${SED_BIN} -i '' \
        -e "s#/usr/local#${PREFIX}#g" \
            "Makefile" \
            "common.gypi" \
            "deps/http_parser/Makefile" \
            "tools/install.py" \
            "deps/npm/lib/config/defaults.js" \
            "deps/npm/lib/utils/completion.sh"
}

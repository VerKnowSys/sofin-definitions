inherit "node"

DEF_VERSION="12.16.3"
DEF_SHA="d17faf7c0bcd20acc8b2475326c9771204447948"
DEF_FULL_NAME="Node.js Erbium-${DEF_VERSION%.*}-LTS"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-v${DEF_VERSION}.tar.xz"
DEF_ORIGIN="https://nodejs.org/dist/latest-v12.x/${DEF_NAME}-v${DEF_VERSION}.tar.xz"
DEF_REQUIREMENTS="pkgconf-static jemalloc libedit gettext libxml2 libevent c-ares lzo pcre perl-static autoconf texinfo automake18 libffi icu yaml python27-static nghttp2"
DEF_CONFIGURE_ARGS="--without-dtrace --with-intl=system-icu --openssl-system-ca-path=${SERVICE_DIR}/etc/ssl --openssl-use-def-ca-store --without-inspector --without-snapshot --without-etw --shared-zlib --shared-nghttp2  --shared-cares"

DEF_AFTER_CONFIGURE_METHOD="node_patch_configured"
node_patch_configured () {
    permnote "Replacing: '/usr/local' with: '${PREFIX}', since /usr/local is hardcoded multiple times among Node source filesâ€¦"
    ${SED_BIN} -i '' \
        -e "s#/usr/local#${PREFIX}#g" \
            "Makefile" \
            "common.gypi" \
            "deps/http_parser/Makefile" \
            "tools/install.py" \
            "deps/npm/lib/config/defaults.js" \
            "deps/npm/lib/utils/completion.sh"
}

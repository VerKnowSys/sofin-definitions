inherit php56

DEF_FULL_NAME="PHP 7.3"
DEF_SUFFIX="73"
DEF_VERSION="7.3.18"
DEF_SHA="06d88a6fdefb115f839133ad465fcc9cb8f46cc5"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_ORIGIN="https://www.php.net/distributions/${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --with-libzip=${PREFIX} --with-sodium=${PREFIX} --enable-intl"
DEF_REQUIREMENTS="libzip libsodium mpdecimal ${DEF_REQUIREMENTS}"
DEF_BUNDLED_EXTENSIONS="decimal apcu xdebug geoip memcached meminfo redis igbinary"
DEF_NO_MPROTECT=YES # JIT enabled
DEF_NO_PAGEEXEC=YES # JIT enabled
DEF_APPLY_LOWER_SECURITY_ON="${DEF_EXPORTS}"
DEF_USE_LTO=YES

install_decimal () {
    arch_name="decimal-1.3.1"
    archive="${arch_name}.tgz"
    try "${FETCH_BIN} ${MAIN_SOURCE_REPOSITORY}${archive} ${FETCH_OPTS}" && \
    try "${TAR_BIN} xf ${archive}" && \
    cd "${arch_name}" && \
    try "${PREFIX}/bin/phpize" && \
    try "./configure --prefix=${PREFIX} --enable-decimal --with-libmpdec-path=${PREFIX} --with-php-config=${PREFIX}/bin/php-config" && \
    try "PATH=${PREFIX}/bin:$PATH make install" && \
    note "Installed Decimal pecl module: ${arch_name}" && \
    return 0
    return 1
}

install_meminfo () {
    phpmeminfo_name="php-meminfo-1.0.5"
    phpmeminfo_archive="${phpmeminfo_name}.tar.gz"
    try "${FETCH_BIN} \"${MAIN_SOURCE_REPOSITORY}${phpmeminfo_archive}\" ${FETCH_OPTS}" && \
    try "${TAR_BIN} xf ${phpmeminfo_archive}" && \
    cd "${phpmeminfo_name}/extension/php7" && \
    try "${PREFIX}/bin/phpize" && \
    try "./configure --prefix=${PREFIX} --with-php-config=${PREFIX}/bin/php-config" && \
    try "PATH=${PREFIX}/bin:$PATH make install" && \
    note "Installed PECL extension: ${phpmeminfo_name}" && \
    return 0
    return 1
}

install_geoip () {
    geoip_name="geoip-1.1.1"
    geoip_archive="${geoip_name}.tgz"
    try "${FETCH_BIN} \"${MAIN_SOURCE_REPOSITORY}${geoip_archive}\" ${FETCH_OPTS}" && \
    try "${TAR_BIN} xf ${geoip_archive}" && \
    cd ${geoip_name} && \
    try "${PREFIX}/bin/phpize" && \
    try "./configure --prefix=${PREFIX} --with-php-config=${PREFIX}/bin/php-config --with-geoip=${PREFIX}" && \
    try "PATH=${PREFIX}/bin:$PATH make install" && \
    note "Installed PECL extension: ${geoip_name}" && \
    return 0
    return 1
}

install_xdebug () {
    arch_name="xdebug-2.7.2"
    archive="${arch_name}.tgz"
    try "${FETCH_BIN} ${MAIN_SOURCE_REPOSITORY}${archive} ${FETCH_OPTS}" && \
    try "${TAR_BIN} xf ${archive}" && \
    cd "${arch_name}" && \
    try "${PREFIX}/bin/phpize" && \
    try "./configure --prefix=${PREFIX} --enable-xdebug --with-php-config=${PREFIX}/bin/php-config" && \
    try "PATH=${PREFIX}/bin:$PATH make install" && \
    note "Installed Xdebug pecl module: ${arch_name}" && \
    return 0
    return 1
}

install_apcu () {
    arch_name="apcu-5.1.17"
    archive="${arch_name}.tgz"
    try "${FETCH_BIN} ${MAIN_SOURCE_REPOSITORY}${archive} ${FETCH_OPTS}" && \
    try "${TAR_BIN} xf ${archive}" && \
    cd "${arch_name}" && \
    try "${PREFIX}/bin/phpize" && \
    try "./configure --prefix=${PREFIX} --enable-apcu --with-php-config=${PREFIX}/bin/php-config" && \
    try "PATH=${PREFIX}/bin:$PATH make install" && \
    note "Installed APCu pecl module: ${arch_name}" && \
    return 0
    return 1
}

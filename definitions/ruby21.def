DEF_FULL_NAME="Ruby YARV 2.1"
DEF_SHA="adcc9e10b8f7add0e19f8c70afc134c069a862ca"
DEF_NAME="ruby"
DEF_VERSION="2.1.10"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_CONFIGURE_SCRIPT="LC_ALL=${LANG} debugflags= ./configure"
DEF_CONFIGURE_ARGS="--enable-pie --enable-shared --with-search-path=${PREFIX}/lib --with-opt-dir=${PREFIX}:${PREFIX}/lib:${PREFIX}/include --disable-install-capi --disable-install-doc --disable-install-rdoc --enable-load-relative --without-valgrind --with-openssl=${PREFIX} --with-dbm=${PREFIX} --with-libffi=${PREFIX} --with-gmp=${PREFIX} --with-mantype=man --with-ruby-version=minor CFLAGS='-I${PREFIX}/include' CPPFLAGS='-I${PREFIX}/include'"
DEF_COMPILER_ARGS="-DDHAVE_GMP_H=1 -DHAVE_LIBGMP=1 -DHAVE_RB_RATIONAL_NUM=1 -DHAVE_RB_RATIONAL_DEN=1"
case "${SYSTEM_NAME}" in
    Linux)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --enable-rpath --with-gcc=/usr/bin/gcc"
        ;;

    Darwin)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --with-jemalloc=${PREFIX} --enable-dtrace --with-gcc=/usr/bin/clang"
        ;;

    FreeBSD)
        DEF_COMPILER_ARGS="${DEF_COMPILER_ARGS}"
        DEF_LINKER_ARGS="${DEF_LINKER_ARGS}"
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --without-jemalloc --enable-libedit --with-libedit-dir=/usr --disable-rpath --enable-dtrace --with-gcc=/usr/bin/clang LIBS='-ldtrace -L${PREFIX}/lib -L/usr/lib'" # --with-jemalloc=${PREFIX} -ljemalloc
        ;;
esac
DEF_REQUIREMENTS="pkgconf make jemalloc m4 libtool zlib bzip2 lzma xz gmp libxml2 libxslt libffi gettext ccache gdbm db sqlite flex perl bison unixodbc openssl python27 yaml libgpg-error libgcrypt autoconf texinfo automake"
DEF_EXPORTS="ruby gem irb ri rdoc erb rake bundle"
DEF_ORIGIN="http://www.ruby-lang.org/en/downloads/"
DEF_CONFLICTS_WITH="Rubinius Jruby Passenger Ruby"
DEF_USELESS="lib/*perl* include/python* lib/python* man share"

DEF_AFTER_INSTALL_METHOD="after_install"
after_install () {
    ${TEST_BIN} -f ${HOME}/.gemrc || ${PRINTF_BIN} 'gem: --no-ri --no-rdoc' > ${HOME}/.gemrc
    ${PREFIX}/bin/gem install bundler
}

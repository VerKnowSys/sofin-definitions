APP_FULL_NAME="Lua"
APP_SHA="b3882111ad02ecc6b972f8c1241647905cb2e3fc"
APP_NAME="lua"
APP_VERSION="5.1.5"
APP_POSTFIX="51"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.gz"
APP_EXPORTS="lua luac"
APP_CONFIGURE_SCRIPT="ignore"
case "${SYSTEM_NAME}" in
    Linux)
        APP_MAKE_METHOD="make linux"
        ;;

    FreeBSD)
        APP_MAKE_METHOD="make freebsd"
        ;;

    Darwin)
        APP_MAKE_METHOD="make macosx"
        ;;

    *)
        APP_MAKE_METHOD="make posix"
        ;;
esac

APP_AFTER_CONFIGURE_CALLBACK="patch_makefile"
patch_makefile () {
    ${SED_BIN} -i '' -e "s#= /usr/local#= ${PREFIX}#" Makefile || true # Linux..
    ${SED_BIN} -i '' -e "s/CFLAGS= .*\$/CFLAGS= -O2 -Wall -mno-avx -fPIC \$(MYCFLAGS)/" src/Makefile || true # Linux..
    if [ "${SYSTEM_NAME}" != "Linux" ]; then
        ${SED_BIN} -i '' -e "s/CC= gcc/CC= clang/" src/Makefile
    fi
}

# because Lua guys possibly don't know how to do things correctly:
APP_AFTER_MAKE_CALLBACK="create_pc"
create_pc () {
    ${MKDIR_BIN} -p ${PREFIX}/lib/pkgconfig
    ${SED_BIN} -i '' -e "s#/usr/local#${PREFIX}#" etc/lua.pc
    ${INSTALL_BIN} -v etc/lua.pc ${PREFIX}/lib/pkgconfig/
}

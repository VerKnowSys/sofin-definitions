DEF_DISABLE_ON="Darwin"
DEF_FULL_NAME="NodeJS - asynchronous, event driven, V8 runtime"
DEF_NAME="node"
DEF_VERSION="8.6.0"
YARN_VERSION="1.2.1"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}-bin.tar.xz"
DEF_ORIGIN="http://nodejs.org/download/"
DEF_SHA="6ad5ed9bc4a4beaddc374318c0991749bcc3e943"
DEF_CONFIGURE_METHOD="binary"
DEF_CLEAN_USELESS=NO
DEF_EXPORTS="node yarn"
DEF_AFTER_UNPACK_METHOD="install_and_patch"
install_and_patch () {
    ${CP_BIN} -fR "${BUILD_DIR}/$(capitalize "${DEF_NAME}")/" "${PREFIX}"
    ${SED_BIN} -i '' -e "s|./node.bin|${PREFIX}/bin/node.bin|" "${PREFIX}/bin/node"
    ${SED_BIN} -i '' -e "s|../lib|${PREFIX}/lib|" "${PREFIX}/bin/node"

    ${FETCH_BIN} "https://github.com/yarnpkg/yarn/releases/download/v${YARN_VERSION}/yarn-${YARN_VERSION}.js"
    ${MV_BIN} -v "yarn-${YARN_VERSION}.js" "${PREFIX}/bin/yarn-${YARN_VERSION}.js"
    ${RM_BIN} -f "${PREFIX}/bin/yarn"
    ${LN_BIN} -s "${PREFIX}/bin/yarn-${YARN_VERSION}.js" "${PREFIX}/bin/yarn"
    ${CHMOD_BIN} 775 "${PREFIX}/bin/yarn"
}

DEF_DISABLE_ON="Darwin Linux"
DEF_FULL_NAME="NodeJS - asynchronous event driven JavaScript runtime"
DEF_NAME="node"
DEF_VERSION="6.2.2"
DEF_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-v${DEF_VERSION}.tar.gz"
DEF_SHA="79dc84334914161c1c8cf3063bd7459eeabf8782"
DEF_ORIGIN="http://nodejs.org/download/"
DEF_MAKE_METHOD="LINK=clang++ strictaliasing=off make -s ${MAKE_OPTS}"
DEF_INSTALL_METHOD="LINK=clang++ make -s install"
DEF_REQUIREMENTS="pkgconf m4 libtool libexecinfo c-ares readline-dynamic zlib bzip2 lzma xz make perl autoconf texinfo automake libuv openssl libxml2 libgpg-error libgcrypt libxslt sqlite yaml libffi python27 icu"
DEF_CONFLICTS_WITH="Node"
DEF_COMPILER_ARGS="-Wno-unused-private-field -Wno-nested-anon-types -Wno-unused-function -Wno-unused-const-variable"
DEF_CONFIGURE_ARGS="--with-dtrace --shared-zlib --shared-openssl --with-intl=system-icu --shared-libuv --shared-cares"
DEF_USELESS="include/python* lib/python* lib/*perl* include/perl* share/texinfo share/ac* share/auto* share/gtk-doc share/libtool"
DEF_USEFUL="bin/node*"
DEF_EXPORTS="node npm node-waf node-gyp coffee lessc uglifyjs cake"
DEF_NO_CCACHE=YES

DEF_AFTER_INSTALL_METHOD="install_default_npm_modules"
install_default_npm_modules () {
    ${PREFIX}/bin/npm install -g coffee-script less uglify-js
    true # Node throws "npm ERR! code -2147483648" on success ;)
}

case "${SYSTEM_NAME}" in
    Darwin)
        DEF_STRIP="libs" # required to NOT strip _node_module_register from node binary. It will cause brunch crashes on OSX 10.10/10.11.
        ;;
    *)
        ;;
esac

DEF_FULL_NAME="Ruby YARV 2.5"
DEF_NAME="ruby"
DEF_VERSION="2.5.5"
DEF_SHA="85cee62e47f0707808ff3d7cb68b6cd075a65509"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_ORIGIN="https://cache.ruby-lang.org/pub/${DEF_NAME}/${DEF_VERSION%.*}/${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_CONFIGURE_METHOD="debugflags= ./configure"
DEF_REQUIREMENTS="libedit jemalloc pcre icu libunistring db libgpg-error libgcrypt gettext yaml sqlite lzo libffi libxml2 libxslt perl-static gdbm libidn2 libevent openssl python27 nghttp2 libssh2 curl libuuid postgresql10 mysql-lib gmp"
DEF_CONFIGURE_ARGS="--without-gcc --enable-pie --enable-shared --with-search-path=${PREFIX}/lib --with-opt-dir=${PREFIX}:${PREFIX}/lib:${PREFIX}/include --enable-install-capi --disable-install-doc --disable-install-rdoc --enable-load-relative --without-valgrind --with-openssl=${PREFIX} --with-gdbm=${PREFIX} --with-readline=${PREFIX} --with-libffi=${PREFIX} --with-gmp=${PREFIX} --with-mantype=man --with-yaml=${PREFIX}"
DEF_STANDALONE=YES
DEF_NO_CCACHE=YES

unset DEF_USE_LTO
DEF_NO_LLVM_LINKER=YES

case "${SYSTEM_NAME}" in
    Linux)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --enable-rpath"
        ;;

    Darwin)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --disable-rpath --enable-dtrace"
        ;;

    FreeBSD)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --enable-rpath --enable-dtrace"
        ;;
esac
DEF_EXPORTS="ruby gem irb ri rdoc erb rake bundle"
DEF_ORIGIN="http://www.ruby-lang.org/en/downloads/"
DEF_CONFLICTS_WITH="Jruby Ruby"
DEF_USELESS="lib/*perl* lib/*python* lib/*.a man share sbin scripts ssl lib/cmake lib/libxslt-plugins lib/*.sh"

DEF_AFTER_INSTALL_METHOD="after_install"
after_install () {
    try "${TEST_BIN} -f ${HOME}/.gemrc" || \
        try "printf 'gem: --no-ri --no-rdoc' > ${HOME}/.gemrc"
    try "${PREFIX}/bin/gem install bundler"
}

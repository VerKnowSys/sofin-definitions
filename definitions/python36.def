DEF_FULL_NAME="Python 3.6"
DEF_NAME="Python"
DEF_VERSION="3.6.8"
DEF_SHA="ee55acedef049268307633cbc9c7ff0610d1244f"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_ORIGIN="https://www.python.org/ftp/python/${DEF_VERSION}/${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_REQUIREMENTS="libffi libressl expat readline gettext gmp"
DEF_CONFIGURE_ARGS="--disable-shared --disable-ipv6 --with-system-expat --with-system-ffi --with-system-libmpdec --with-hash-algorithm=fnv --with-doc-strings --with-ensurepip --with-libs='-lncursesw -lpthread -lm -lgmp -lssl -lintl -lexpat -lffi -ldl' OPT= LDFLAGS='-L${PREFIX}/lib -Wl,-rpath=${PREFIX}/lib,--enable-new-dtags -Wl,-Bsymbolic-functions -fPIC'"
DEF_LINKER_FLAGS="-fPIC -L${PREFIX}/lib -Wl,-Bsymbolic-functions -Wl,-rpath=${PREFIX}/lib,--enable-new-dtags"
DEF_EXPORTS="python3 python3-config python3.6 python3.6m python3.6m-config python3.6-config easy_install3 pip3 pip3.6 pyvenv pyvenv-3.6 pydoc3 pydoc3.6 easy_install-3.6"
DEF_USELESS="share/gtk-doc lib/*perl* lib/*.a include lib/pkgconfig docs man share/aclocal share/libtool share/readline libdata lib/*.sh share/gettext* share/pkgconfig lib/cmake ssl"

DEF_AFTER_CONFIGURE_METHOD="patch_so_called_config_of_so_called_language"
patch_so_called_config_of_so_called_language () {
    ${SED_BIN} -i '' -e 's|#define HAVE_DEV_PTMX 1|#undef HAVE_DEV_PTMX|' pyconfig.h
    echo "#define HAVE_TIMEGM 1" >> pyconfig.h
    echo "#define MAX_GROUPS 4096" >> Modules/posixmodule.h
}

DEF_CONFLICTS_WITH="Python3"
DEF_NO_FAST_MATH=YES
DEF_NO_CCACHE=YES
DEF_NO_HARDEN_FLAGS=YES
DEF_NO_PIE=YES # actually matters. With that enabled there's no way of linkin unicodedata which is required for pip
DEF_STRIP=NO
unset DEF_USE_LTO

DEF_FULL_NAME="Riak Distributed KV"
DEF_NAME="riak"
DEF_SHA="e442759f96daa8ef42f618cba419bc80abd1fc1b"
DEF_VERSION="2.1.4"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.gz"
DEF_CONFIGURE_METHOD="no-conf"
DEF_REQUIREMENTS="pkgconf make m4 lzo lz4 readline libressl perl otp17 nspr"
DEF_EXPORTS="riak riak-admin riak-debug search-cmd"
DEF_CLEAN_USELESS=NO
DEF_STANDALONE=YES
DEF_LINKER_NO_DTAGS=YES
DEF_NO_CCACHE=YES
DEF_NO_LLVM_LINKER=YES


DEF_MAKE_METHOD="make_riak"
make_riak () {
    _srcpath="$(pwd)"
    CFLAGS="-I${PREFIX}/include -I${_srcpath}/deps/eleveldb/c_src/leveldb/include -pthread"
    CXXFLAGS="-I${PREFIX}/include -I${_srcpath}/deps/eleveldb/c_src/leveldb/include -pthread"
    LDFLAGS="-L${PREFIX}/lib -L/usr/lib -lpthread"

    note "Building Riak v${DEF_VERSION}"
    PATH=/Software/Git/exports:${PATH} make rel
}

DEF_INSTALL_METHOD="install_riak"
install_riak () {
    note "Installing Riak v${DEF_VERSION}"
    ${CP_BIN} -vR "rel/riak/" "${PREFIX}/"
}

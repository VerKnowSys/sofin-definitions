DEF_FULL_NAME="OCaml"
DEF_SHA="55b9f90603f43cd84abba4db6f3a05a6040c505a"
DEF_STANDALONE=YES
DEF_NAME="ocaml"
DEF_VERSION="4.07.1"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.gz"
DEF_REQUIREMENTS="pkgconf make lzo lz4 lzma xz pcre db perl openssl"
DEF_CONFIGURE_METHOD="posix"
DEF_CONFIGURE_OPTS="-fPIC -safe-string -with-pthread"
DEF_MAKE_METHOD="AR=ar make -s world.opt ${MAKE_OPTS}"
DEF_INSTALL_METHOD="make -s install"
DEF_USELESS="lib/*.a lib/perl5 include/openssl docs ssl share/aclocal"
DEF_USEFUL="bin/ocaml*"
DEF_EXPORTS="ocaml ocamlc camlp4r camlp4oof camlp4orf ocamlbuild ocamlcp ocamlrun camlp4 camlp4o camlp4of camlp4oof camlp4orf camlp4prof ocamldep ocamllex ocamlmklib ocamlmktop ocamlobjinfo ocamlyacc ocamlopt ocamldoc"
DEF_NO_TRAP_INT_OVERFLOW=YES
DEF_NO_CCACHE=YES
DEF_USE_SAFE_STACK=YES

# Ocaml build system doesn't recognize relro linker feature:
unset DEF_COMPILER_FLAGS DEF_LINKER_FLAGS CFLAGS CXXFLAGS LDFLAGS

# NOTE: override Sofin compiler setup - special case - no BINDNOW and no RELRO feature:
CFLAGS="-O2 -w -Wl,-rpath=${PREFIX}/lib,--enable-new-dtags ${HARDEN_CFLAGS} -fPIE ${HARDEN_SAFE_STACK_FLAGS} ${HARDEN_CMACROS}"
CXXFLAGS="-O2 -w -Wl,-rpath=${PREFIX}/lib,--enable-new-dtags ${HARDEN_CFLAGS} -fPIE ${HARDEN_SAFE_STACK_FLAGS} ${HARDEN_CMACROS}"
LDFLAGS="-L${PREFIX}/lib -L/usr/lib ${HARDEN_SAFE_STACK_FLAGS} -fPIC -fPIE -pie"
LD="ld.lld -m elf_x86_64_fbsd -pie"

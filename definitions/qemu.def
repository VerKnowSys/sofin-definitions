DEF_DISABLE_ON="Linux Minix"
DEF_FULL_NAME="QEMU is a generic and open source machine emulator and virtualizer."
DEF_NAME="qemu"
DEF_SHA="10c2730bb48b1ab4f4d568c3ea2c12a8c35f5106"
DEF_VERSION="2.12.1"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_ORIGIN="https://download.qemu.org/${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_REQUIREMENTS="jemalloc bison bzip2 libzip lzma lzo lzop lz4 zip db sqlite pcre readline libffi autoconf texinfo automake icu gettext glib libpcap libidn libidn2 libressl libevent nghttp2 libssh2 curl libgpg-error gmp pixman nettle libtasn1 p11-kit gnutls userspace-rcu mpfr libmpc isl012 libusb vde2 vdetelweb sdl2-lib libmodplug libogg libvorbis flac sdl2-mixer sdl2-image freetype libxml2 fontconfig sdl2-ttf libpng zlib"
DEF_CONFIGURE_ARGS="--cxx=clang++ --cc=clang --interp-prefix='${PREFIX}/lib/qemu-%%M' --extra-cflags='${CFLAGS} -DPREFIX=${PREFIX}' --extra-ldflags='-L${PREFIX}/lib ${LDFLAGS}' --enable-bsd-user --disable-linux-user --enable-gnutls --enable-nettle --enable-curl --enable-jemalloc --enable-fdt --enable-libssh2 --enable-bzip2 --enable-libusb --enable-vnc --enable-vnc-png --enable-coroutine-pool --disable-werror --disable-docs --disable-gtk --disable-guest-agent --disable-xen --disable-xen-pci-passthrough --disable-netmap --disable-vhost-net --disable-spice --disable-usb-redir --disable-libiscsi --disable-rdma --disable-kvm --target-list=aarch64-softmmu --disable-strip --disable-user" # disable-user: http://ół.pl/fb0e6450c1583fd6acfed4225c7a5b23.png --disable-virtfs --disable-sparse --enable-curses
DEF_COMPILER_FLAGS="-I${PREFIX}/include"
DEF_LINKER_FLAGS="-L${PREFIX}/lib -stdlib=libc++"
case "${SYSTEM_NAME}" in
    Darwin)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --disable-cocoa --enable-sdl"
        ;;

    *)
        DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --enable-pcap --enable-sdl --enable-system --enable-pie --enable-lzo --enable-seccomp --enable-vde --enable-attr --enable-numa --enable-libnfs --enable-tpm --enable-trace-backends=dtrace --python=${PREFIX}/bin/python" # --with-coroutine=gthread
        ;;
esac
DEF_USEFUL="bin/qemu*"
DEF_USELESS="share/gtk* share/glib* share/ac* share/auto* share/gettext share/glib* share/read* share/bison share/readline share/texinfo include lib/*.a lib/*.sh lib/*.al"
DEF_EXPORTS="qemu-img qemu-nbd qemu-system-i386 qemu-system-x86_64 qemu-io qemu-system-arm qemu-system-mips qemu-system-aarch64"
DEF_NO_CCACHE=YES
DEF_NO_FAST_MATH=YES
unset DEF_USE_LTO

DEF_CRITICAL=YES
DEF_STANDALONE=YES
DEF_FULL_NAME="Z-Shell"
DEF_NAME="zsh"
DEF_SHA="f10d17431ce2c867f7c99e3f539c6cf458461874"
DEF_VERSION="5.6.2"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_ORIGIN="http://zsh.sourceforge.net/Arc/source.html"
DEF_CONFIGURE_ARGS="--disable-dynamic --enable-cap --enable-pcre --enable-multibyte --enable-unicode9 --disable-maildir-support --enable-gdbm --enable-fndir=${PREFIX}/share/zsh/functions --enable-scriptdir=${PREFIX}/share/zsh/scripts --enable-site-fndir=${SERVICE_DIR}/share/zsh/site-functions --enable-site-scriptdir=${SERVICE_DIR}/share/zsh/site-scripts --enable-runhelpdir=${PREFIX}/share/zsh/help --enable-additional-fpath=${SERVICE_DIR}/share/zsh/functions"
DEF_REQUIREMENTS="pkgconf make libtool libedit zlib bzip2 xz lzma lzo lz4 db gdbm pcre"
DEF_TEST_METHOD="make -j${CPUS:-8} check"

DEF_AFTER_INSTALL_METHOD="link_sh"
link_sh () {
    debug "Linking $(distd "${PREFIX}/bin/zsh => ${PREFIX}/bin/sh"), $(distd "${PREFIX}/bin/zsh-${DEF_VERSION} => ${PREFIX}/bin/zsh")"
    try " \
        ${RM_BIN} -f ${PREFIX}/bin/sh ${PREFIX}/bin/zsh; \
        ${LN_BIN} -s ${PREFIX}/bin/zsh-${DEF_VERSION} ${PREFIX}/bin/zsh; \
        ${LN_BIN} -s ${PREFIX}/bin/zsh ${PREFIX}/bin/sh; \
        "
}

DEF_AFTER_EXPORT_METHOD="validate_product"
validate_product () {
    parse_version "${DEF_VERSION}"
    debug "validate_product(version=$(distd "${_major}.${_minor}.${_micro}"))"
    try "${PREFIX}/bin/zsh --version 2>/dev/null | ${GREP_BIN} -F \"${_major}.${_minor}\" >/dev/null 2>&1"
}

DEF_USEFUL="bin/zsh-${DEF_VERSION}"
DEF_EXPORTS="zsh sh"
DEF_USE_SAFE_STACK=YES
DEF_NO_TRAP_INT_OVERFLOW=YES

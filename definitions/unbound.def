DEF_DISABLE_ON="Darwin"
DEF_FULL_NAME="Unbound DNS"
DEF_STANDALONE=YES
DEF_NAME="unbound"
DEF_VERSION="1.8.0"
DEF_ORIGIN="http://www.unbound.net/downloads/"
DEF_SHA="52b5b4169b9adaa24cc668976b9dffcc025120d6"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.gz"
DEF_REQUIREMENTS="pkgconf expat libressl libevent libsodium"
DEF_CONFIGURE_ARGS="--enable-pie --enable-relro-now --enable-shared --with-pthreads --with-libexpat=${PREFIX} --with-ssl=${PREFIX} --with-libevent=${PREFIX} --with-libsodium=${PREFIX} --enable-dnscrypt --with-conf-file=${SERVICE_DIR}/service.conf --with-pidfile=${SERVICE_DIR}/service.pid --with-rootkey-file=${SERVICE_DIR}/root.key --with-run-dir=${SERVICE_DIR}"
DEF_EXPORTS="unbound unbound-anchor unbound-checkconf unbound-control unbound-control-setup"

DEF_AFTER_EXPORT_METHOD="validate_product"
validate_product () {
    _ldd_content="$(ldd "${PREFIX}/sbin/unbound" 2>&1)"
    _product_version="$("${PREFIX}/sbin/unbound" -v 2>&1)"
    debug "validate_product($(distd "Unbound")): ${_ldd_content} + ${_product_version}"
    echo "${_product_version}" | ${GREP_BIN} "${DEF_VERSION}" && \
        echo "${_ldd_content}" | ${GREP_BIN} 'libsodium' && \
        echo "${_ldd_content}" | ${GREP_BIN} 'libssl' && \
        echo "${_ldd_content}" | ${GREP_BIN} 'libevent' && \
        echo "${_ldd_content}" | ${GREP_BIN} 'libcrypto' && \
        return 0
    return 1
}

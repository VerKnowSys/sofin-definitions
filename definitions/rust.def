DEF_FULL_NAME="Rust + Cargo + Utilities"
DEF_NAME="rust"
DEF_VERSION="1.21.0"
DEF_CONFIGURE_METHOD="binary"
DEF_CLEAN_USELESS=NO
DEF_EXPORTS="rustc cargo cargo-count cargo-do cargo-check cargo-modules cargo-watch cargo-fmt rustfmt racer rls rust-gdb rust-lldb rustdoc"

case "${SYSTEM_NAME}" in
    Darwin)
        DEF_SHA="a605caf3f2f15259291fcc101c964d17b2f2d426"
        DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}-x86_64-apple-darwin.tar.gz"
        ;;

    FreeBSD)
        DEF_SHA="f70e1900928c3608938fb014e282d7257b10fcdf"
        DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}-x86_64-unknown-freebsd.tar.gz"
        ;;
esac

DEF_AFTER_UNPACK_METHOD="patch_prefix_and_install"
patch_prefix_and_install () {
    ${SED_BIN} -i '' -e "s|/usr/local|${PREFIX}|g" install.sh
    note "Installing Rust v${DEF_VERSION}"
    run "./install.sh"
}

DEF_AFTER_MAKE_METHOD="install_utils"
install_utils () {
    note "Installing: $(distn "racer, cargo-watch, cargo-do, rustfmt, cargo-count")"
    for _add in racer cargo-watch cargo-do rustfmt cargo-count; do
        PATH="${PREFIX}/bin:/bin:/usr/bin" cargo install "${_add}"
    done
}

DEF_FULL_NAME="VI File Manager"
DEF_NAME="vifm"
DEF_ORIGIN="https://vifm.info"
DEF_VERSION="0.9.1"
DEF_SHA="e444bd85d32a4cba1d7e47f5aa53d94c784aceda"
DEF_REQUIREMENTS="pkgconf make"
DEF_CONFIGURE_ARGS="--disable-desktop-files --without-X11 --without-gtk --enable-extended-keys"
DEF_EXPORTS="vifm vifm-pause vifmrc-converter"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.gz"
DEF_AFTER_EXPORT_METHOD="update_vifm_default_config"
DEF_CONFLICTS_WITH="vifm-devel"
DEF_STANDALONE=YES
DEF_MAKE_METHOD="make -s"
DEF_INSTALL_METHOD="make -s install"

update_vifm_default_config () {
  try "${MKDIR_BIN} -p $HOME/.vifm"
  try "${MV_BIN} $HOME/.vifm/vifmrc $HOME/.vifm/vifmrc.old-$(${DATE_BIN} +%Y-%m-%d-%H-%M-%S)"
  printf "
set vicmd=vi
set history=100
set followlinks
set sortnumbers
set undolevels=100
set runexec
set iec
set trash
set nofastrun
set wildmenu
set ignorecase
set smartcase
set hlsearch
set incsearch

nmap <f2> :chmod<cr>
nmap <f3> :!less %%f<cr>
nmap <f4> :!touch<space>
nmap <f5> :!cp %%f %%D<cr>
nmap <f6> :!mv %%f %%D<cr>
nmap <f7> :!mkdir<space>
nmap <f8> :delete<cr>

nmap s :sh<cr>
nmap S :sort<cr>
nmap w :view<cr>
nmap h :cd ~<cr>
nmap C :chmod<cr>
nmap r :!./%%c<space>

windo normal zo

set vifminfo=dhistory,savedirs,chistory,state,tui,shistory,phistory,dirstack,registers,bookmarks

execute 'set statusline=\"  %%t%%= %%A %%10u:%%-7g %%15s %%20d     logged as: '.\$USER.'  \"'

windo set viewcolumns=-{name}..,7{uname},7{gname},7{mtime},11{perms},9{}

" > "$HOME/.vifm/vifmrc"
  try "${MKDIR_BIN} -p $HOME/.vifm/colors"
  if [ "$(id -u)" = "0" ]; then
    try "${MV_BIN} $HOME/.vifm/colors/dmilith-root $HOME/.vifm/colors/dmilith-root-$(${DATE_BIN} +%s)"
    printf "
highlight Win cterm=none ctermfg=white ctermbg=black
highlight Directory cterm=bold ctermfg=cyan ctermbg=black
highlight Link cterm=bold ctermfg=yellow ctermbg=black
highlight BrokenLink cterm=bold ctermfg=red ctermbg=none
highlight Socket cterm=bold ctermfg=magenta ctermbg=black
highlight Device cterm=bold ctermfg=red ctermbg=black
highlight Fifo cterm=bold ctermfg=cyan ctermbg=none
highlight Executable cterm=bold ctermfg=green ctermbg=black
highlight Selected cterm=bold ctermfg=magenta ctermbg=black
highlight CurrLine cterm=bold ctermfg=white ctermbg=30
highlight TopLine cterm=bold ctermfg=white ctermbg=red
highlight TopLineSel cterm=bold ctermfg=yellow ctermbg=red
highlight StatusLine cterm=bold ctermfg=white ctermbg=red
highlight WildMenu cterm=underline,reverse ctermfg=white ctermbg=black
highlight CmdLine cterm=none ctermfg=white ctermbg=black
highlight ErrorMsg cterm=none ctermfg=red ctermbg=black
highlight Border cterm=none ctermfg=black ctermbg=red
" > "$HOME/.vifm/colors/dmilith-root"
    printf "colorscheme dmilith-root" >> "$HOME/.vifm/vifmrc"
  else
    try "${MV_BIN} $HOME/.vifm/colors/dmilith-user $HOME/.vifm/colors/dmilith-user-$(${DATE_BIN} +%Y-%m-%d-%H-%M-%S)"
    printf "
highlight Win cterm=none ctermfg=white ctermbg=black
highlight Directory cterm=bold ctermfg=cyan ctermbg=black
highlight Link cterm=bold ctermfg=yellow ctermbg=black
highlight BrokenLink cterm=bold ctermfg=red ctermbg=none
highlight Socket cterm=bold ctermfg=magenta ctermbg=black
highlight Device cterm=bold ctermfg=red ctermbg=black
highlight Fifo cterm=bold ctermfg=cyan ctermbg=none
highlight Executable cterm=bold ctermfg=green ctermbg=black
highlight Selected cterm=bold ctermfg=magenta ctermbg=black
highlight CurrLine cterm=bold ctermfg=white ctermbg=30
highlight TopLine cterm=bold ctermfg=white ctermbg=blue
highlight TopLineSel cterm=bold ctermfg=yellow ctermbg=blue
highlight StatusLine cterm=bold ctermfg=white ctermbg=blue
highlight WildMenu cterm=underline,reverse ctermfg=white ctermbg=black
highlight CmdLine cterm=none ctermfg=white ctermbg=black
highlight ErrorMsg cterm=none ctermfg=red ctermbg=black
highlight Border cterm=none ctermfg=black ctermbg=blue
" > "$HOME/.vifm/colors/dmilith-user"
    printf "colorscheme dmilith-user" >> "$HOME/.vifm/vifmrc"
  fi
  return 0
}

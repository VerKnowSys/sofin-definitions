DISABLED_ON="Darwin Linux"
APP_FULL_NAME="Grub2 for BHYVE"
APP_NAME="grub2-bhyve"
APP_GIT_MODE="true"
APP_VERSION="0.40"
APP_GIT_CHECKOUT="v${APP_VERSION}"
APP_HTTP_PATH="https://github.com/grehan-freebsd/${APP_NAME}.git"
APP_CONFIGURE_ARGS="CC=${PREFIX}/bin/gcc LEX=${PREFIX}/bin/flex --with-platform=emu --enable-grub-mount=no --enable-grub-mkfont=no --enable-grub-emu-sdl=no --disable-nls --disable-werror --with-bootdir=${SERVICE_DIR}/boot --with-grubdir=${SERVICE_DIR}/boot/grub --with-gnu-ld"
APP_REQUIREMENTS="gmake m4 perl bison flex libressl python27 gmp4 mpfr libmpc zip isl012 binutils-gold libtool gettext gcc"
APP_USELESS="include/python* lib/*perl* lib/*python* lib/gcc lib/gettext lib/include libexec sbin share/gettext* share/aclocal share/libtool share/bison x86_64-unknown-freebsd* include lib/*.la lib/*.py share/man/man3"
APP_EXPORTS="grub-bhyve grub-editenv grub-emu grub-emu-lite grub-fstest grub-kbdcomp grub-menulst2cfg grub-mkimage grub-mklayout grub-mkpasswd-pbkdf2 grub-mkrelpath grub-mkstandalone grub-script-check"
CROSS_PLATFORM_COMPILER_FLAGS="-w -O2 -fno-strict-overflow -fno-stack-protector"
DEFAULT_COMPILER_FLAGS="${CROSS_PLATFORM_COMPILER_FLAGS} -Wl,-fuse-ld=gold"
APP_LINKER_ARGS="-lssp -fno-stack-protector -Wl,-fuse-ld=gold"
APP_MAKE_METHOD="gmake -s ${MAKE_FLAGS}"
APP_INSTALL_METHOD="gmake -s install"
APP_AFTER_INSTALL_CALLBACK="make_link_and_service_dirs"
make_link_and_service_dirs () {
    ${LN_BIN} -s ${PREFIX}/bin/grub-emu ${PREFIX}/bin/grub-bhyve
    ${MKDIR_BIN} -p ${SERVICE_DIR}/boot/grub ${PREFIX}/sbin
}

DEF_FULL_NAME="Music Player Daemon"
DEF_STANDALONE="true"
DEF_NAME="mpd"
DEF_SHA="2b110898c8365ce69a8cedd01db2404748c4c09c"
DEF_VERSION="0.19.16"
DEF_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.xz"
DEF_REQUIREMENTS="pkgconf make ccache jemalloc sqlite pcre libiconv libatomic_ops m4 zlib lame lzma lzo xz bzip2 zip cmake boost-minimal nasm libressl perl python27 autoconf automake libtool zziplib expat texinfo libevent spdylay nghttp2 libidn curl libffi gettext glib libmpdclient mpc db yasm fftw openal faac libid3tag mpg123 libcue libdca taglib yajl faad neon libogg libvorbis flac opus opus-tools libtheora uriparser libxspf speex speexdsp libao wavpack libsndfile twolame libbs2b libmpcdec libmad libshout soxr sox ffmpeglib mpdscribble"
DEF_CONFIGURE_ARGS="--with-boost=${PREFIX} --enable-zzip --enable-database --enable-libmpdclient --enable-ffmpeg --enable-flac --enable-id3 --enable-wave-encoder --enable-lame-encoder --enable-mpg123 --disable-nfs --disable-icu --disable-inotify --enable-curl --enable-soxr --enable-shout --enable-vorbis --enable-bzip2 --enable-wavpack --disable-epoll --enable-glib --enable-zlib --enable-openal --enable-opus --enable-sqlite --enable-httpd-output"
DEF_EXPORTS="mpd mpc mpdscribble"
DEF_USELESS="ssl doc* share man include/boost include/python* lib/python* include/perl* lib/perl*"
DEF_AFTER_UNPACK_METHOD="prepare_lazily ; ./autogen.sh"
DEF_AFTER_INSTALL_METHOD="create_mpdconf ; make_dirs"

make_dirs () {
    ${MKDIR_BIN} -p ${SERVICE_DIR}/var/run ${SERVICE_DIR}/var/log ${SERVICE_DIR}/var/db
}

create_mpdconf () {
    if [ ! -f "${SERVICE_DIR}/etc/mpd.conf.example" ]; then
        ${CP_BIN} -v doc/mpdconf.example ${SERVICE_DIR}/etc/mpd.conf.example
    fi
}

prepare_lazily () {
    case "${SYSTEM_NAME}" in
        Darwin)
            DEF_CONFIGURE_ARGS="--enable-osx --enable-eventfd ${DEF_CONFIGURE_ARGS}"
            ;;

        FreeBSD)
            DEF_LINKER_ARGS="-L${PREFIX}/lib -lm -lavutil"
            DEF_COMPILER_ARGS="-I${PREFIX}/include -lm -arch=x86_64 -lavutil"
            ;;
    esac
}


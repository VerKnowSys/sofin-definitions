DEF_DISABLE_ON="FreeBSD Linux"
DEF_FULL_NAME="Rubinius Ruby VM"
DEF_SHA="a5b5c0d194b462bfe95f4cf93c1cdbe79bf809ed"
DEF_NAME="rubinius"
DEF_REQUIREMENTS="make bzip2 xz libffi libxml2 python27 ccache cmake llvm m4 libtool libgpg-error libgcrypt libxslt yaml sqlite perl bison openssl ruby22"
DEF_VERSION="3.51"
DEF_SOURCE_PATH="${MAIN_SOURCE_REPOSITORY}${DEF_NAME}-${DEF_VERSION}.tar.bz2"
DEF_EXPORTS="ruby rbx gem irb ri rdoc erb rake bundle bundle rackup"
DEF_MAKE_METHOD="rake install"
DEF_INSTALL_METHOD="true"
DEF_NO_CCACHE="YES"
DEF_AFTER_UNPACK_CALLBACK="bundle install"
DEF_AFTER_INSTALL_CALLBACK="afterInstall"
DEF_CONFIGURE_ARGS="--release-build --preserve-prefix --llvm-path=${PREFIX} --llvm-shared"
case "${SYSTEM_NAME}" in
  FreeBSD)
    DEF_REQUIREMENTS="libexecinfo ${DEF_REQUIREMENTS}"
    DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --with-dtrace --with-execinfo --with-rpath"
    ;;
  Darwin)
    DEF_CONFIGURE_ARGS="${DEF_CONFIGURE_ARGS} --without-rpath"
    DEF_STRIP="no"
    ;;
esac
DEF_CONFLICTS_WITH="Rubinius Jruby Passenger Ruby"
DEF_USELESS="lib/*perl* include/python* lib/python* man share"

afterInstall () {
    # remove old, unnecessary and unused stuff from base, fixing paths
    ${RM_BIN} -rf ${PREFIX}/lib/ruby
    ${MV_BIN} ${PREFIX}/gems/bin/* ${PREFIX}/bin/
    ${RM_BIN} -rf ${PREFIX}/gems/bin
    ${LN_BIN} -s ${PREFIX}/bin ${PREFIX}/gems/bin
}

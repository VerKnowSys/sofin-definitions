APP_FULL_NAME="Percona Server 5.6"
APP_SHA="346c96c951a566bdc52aef3c1f9dcd124d08b705"
APP_NAME="percona-server"
APP_POSTFIX="56"
APP_VERSION="5.6.22-71.0"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.gz"
APP_REQUIREMENTS="zlib bzip2 expat libiconv cmake ncurses m4 bison"
APP_CONFIGURE_ARGS="-DMYSQL_DATADIR=${SOFTWARE_DATA_DIR} -DWITH_SSL=yes -DWITH_ZLIB=yes"
case "${SYSTEM_NAME}" in
    Darwin)
        export APP_REQUIREMENTS="zlib bzip2 expat cmake ncurses"
        ;;
    Linux)
        export APP_CONFIGURE_ARGS="${APP_CONFIGURE_ARGS} -DENABLE_DTRACE=OFF"
        ;;
esac

APP_CONFIGURE_SCRIPT="cmake"
#APP_AFTER_INSTALL_CALLBACK="cd ${PREFIX} && ${PREFIX}/bin/perl scripts/mysql_install_db"
APP_EXPORTS="mysql mysql_config mysqld mysqld_multi mysqld_safe mysqladmin mysqlshow mysqlimport mysqlbinlog mysqldump mysqlaccess mysqlcheck mysqlhotcopy mysql_upgrade mysql_install_db mysql-proxy"
APP_CONFLICTS_WITH="Percona Mysql"

APP_AFTER_INSTALL_CALLBACK="after_build"
after_build () {
    mysql_proxy_name="mysql-proxy"
    mysql_proxy_version="0.8.5"
    mysql_proxy_archive="${mysql_proxy_name}-${mysql_proxy_version}.tar.gz"
    ${FETCH_BIN} ${MAIN_SOURCE_REPOSITORY}${mysql_proxy_archive}
    tar xf ${mysql_proxy_archive}
    cd ${mysql_proxy_name}-${mysql_proxy_version}
    PATH=${PREFIX}/bin:/bin:/usr/bin ./configure --prefix ${PREFIX}
    make install
}

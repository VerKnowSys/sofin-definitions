APP_FULL_NAME="MongoDB - NoSQL database"
APP_STANDALONE="true"
APP_NAME="mongodb"
APP_SHA="f5a68505a0de1152b534d62a8f0147d258d503a0"
APP_VERSION="2.6.5"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-src-r${APP_VERSION}.tar.gz"
APP_REQUIREMENTS="libiconv bzip2 python27 scons libexecinfo gmake nspr"
APP_CONFIGURE_SCRIPT="ignore"
APP_MAKE_METHOD="true"
case "${SYSTEM_NAME}" in
    Darwin)
        export APP_INSTALL_METHOD="scons ${MAKE_OPTS} --cc='/usr/bin/clang -w' --cxx='/usr/bin/clang++ -w' --extrapath=${PREFIX} --64 --release --prefix=${PREFIX} install"
        ;;

    Linux)
        export APP_INSTALL_METHOD="scons ${MAKE_OPTS} --cc='/usr/bin/gcc -w' --cxx='/usr/bin/g++ -w' --extrapath=${PREFIX} --64 --release --prefix=${PREFIX} install"
        ;;

    *)
        # cannot be built with clang: https://groups.google.com/group/mongodb-user/browse_thread/thread/988eebe374e43624?hl=en&noredirect=true&pli=1
        export APP_INSTALL_METHOD="scons ${MAKE_OPTS} --cc='/Software/Gcc/exports/gcc -w' --cxx='/Software/Gcc/exports/g++ -w' --extrapath=${PREFIX} --64 --release --prefix=${PREFIX} install"
        ;;
esac
APP_EXPORTS="mongo mongod mongos mongostat mongodump mongoexport mongoperf mongofiles mongotop mongooplog"
APP_AFTER_INSTALL_CALLBACK="strip_binaries" # NOTE: because Mongodb creators are pretty insane, each binary has more than 400MiB in size!!

strip_binaries () {
    for binary in ${PREFIX}/bin/mongo*; do
        ${STRIP_BIN} -v $binary
    done
}

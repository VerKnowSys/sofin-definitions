DISABLE_ON="FreeBSD Linux"
APP_FULL_NAME="Rubinius Ruby VM"
APP_SHA="c3dd6684c17e05953d6dff932ad511ac988b7b15"
APP_NAME="rubinius"
APP_VERSION="3.13"
APP_POSTFIX="30"
APP_HTTP_PATH="${MAIN_SOURCE_REPOSITORY}${APP_NAME}-${APP_VERSION}.tar.bz2"
APP_REQUIREMENTS="zlib bzip2 gmake libxml2 libiconv python27 llvm35 m4 libtool libgpg-error libgcrypt libxslt yaml sqlite perl bison openssl ruby23"
APP_EXPORTS="ruby rbx gem irb ri rdoc erb rake bundle"
APP_MAKE_METHOD="rake install"
APP_INSTALL_METHOD="true"
APP_NO_CCACHE="YES"
APP_AFTER_UNPACK_CALLBACK="bundle install"
APP_AFTER_INSTALL_CALLBACK="afterInstall"
APP_CONFIGURE_ARGS="--release-build --preserve-prefix --llvm-path=${PREFIX} --llvm-shared"
case "${SYSTEM_NAME}" in
  FreeBSD)
    APP_REQUIREMENTS="libexecinfo ${APP_REQUIREMENTS}"
    APP_CONFIGURE_ARGS="${APP_CONFIGURE_ARGS} --with-dtrace --with-execinfo --with-rpath"
    ;;
  Darwin)
    APP_CONFIGURE_ARGS="${APP_CONFIGURE_ARGS} --without-rpath"
    APP_STRIP="no"
    ;;
esac
APP_CONFLICTS_WITH="Rubinius Jruby Passenger Ruby"
APP_USELESS="lib/libperl.so lib/perl5 include/python2.7 lib/python2.7 man share"

afterInstall () {
    # remove old, unnecessary and unused stuff from base, fixing paths
    ${RM_BIN} -rf ${PREFIX}/lib/ruby
    ${MV_BIN} ${PREFIX}/gems/bin/* ${PREFIX}/bin/
    ${RM_BIN} -rf ${PREFIX}/gems/bin
    ${LN_BIN} -s ${PREFIX}/bin ${PREFIX}/gems/bin
}
